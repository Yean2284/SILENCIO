<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FastCut AI | Video & Audio Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background: #0b0f1a; color: white; font-family: 'Inter', sans-serif; }
        .card-glass { background: rgba(23, 30, 49, 0.8); border: 1px solid rgba(168, 85, 247, 0.3); backdrop-filter: blur(12px); }
        .gradient-text { background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const { createFFmpeg, fetchFile } = FFmpeg;

        function App() {
            const [file, setFile] = useState(null);
            const [isProc, setIsProc] = useState(false);
            const [outputUrl, setOutputUrl] = useState(null);
            const [sensitivity, setSensitivity] = useState(0.4);
            const [error, setError] = useState(null);
            const ffmpeg = useRef(null);

            useEffect(() => { 
                loadFFmpeg(); 
            }, []);

            const loadFFmpeg = async () => {
                try {
                    ffmpeg.current = createFFmpeg({ 
                        log: true,
                        corePath: 'https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js'
                    });
                    await ffmpeg.current.load();
                } catch (e) {
                    setError("Error al cargar motor de video. Verifica tu conexi√≥n o headers.");
                }
            };

            const processMedia = async () => {
                if (!file || !ffmpeg.current.isLoaded()) return;
                setIsProc(true);
                setError(null);
                
                try {
                    const ext = file.name.split('.').pop();
                    const inputName = `input.${ext}`;
                    const isVideo = file.type.includes('video');
                    const outputName = isVideo ? 'output.mp4' : 'output.mp3';

                    ffmpeg.current.FS('writeFile', inputName, await fetchFile(file));

                    // Comando optimizado para mayor compatibilidad y velocidad
                    // -af silenceremove corta el silencio tanto en audio como en los frames de video
                    await ffmpeg.current.run(
                        '-i', inputName,
                        '-af', `silenceremove=stop_periods=-1:stop_duration=${sensitivity}:stop_threshold=-30dB`,
                        ...(isVideo ? ['-c:v', 'libx264', '-preset', 'ultrafast', '-crf', '28', '-c:a', 'aac'] : []),
                        outputName
                    );

                    const data = ffmpeg.current.FS('readFile', outputName);
                    const url = URL.createObjectURL(new Blob([data.buffer], { type: isVideo ? 'video/mp4' : 'audio/mp3' }));
                    
                    setOutputUrl(url);
                } catch (e) {
                    setError("Error de procesamiento. El video podr√≠a ser demasiado grande.");
                } finally {
                    setIsProc(false);
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6">
                    <div className="card-glass p-8 rounded-[2.5rem] max-w-md w-full shadow-2xl">
                        <h1 className="text-3xl font-black text-center gradient-text mb-2 uppercase tracking-tighter">FastCut AI</h1>
                        <p className="text-center text-gray-400 text-[10px] mb-6 uppercase tracking-widest font-bold">Smart Video Editing Studio</p>

                        {error && <div className="bg-red-500/20 text-red-400 text-xs p-3 rounded-lg mb-4 text-center">{error}</div>}

                        <div className="mb-6 p-4 bg-black/40 rounded-2xl border border-white/5">
                            <label className="text-[10px] font-bold text-purple-400 block mb-2 uppercase">Ajuste de Silencio</label>
                            <input type="range" min="0.1" max="1.5" step="0.1" value={sensitivity} 
                                   onChange={(e) => setSensitivity(e.target.value)} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500"/>
                            <div className="flex justify-between text-[9px] mt-2 text-gray-500 font-bold">
                                <span>CORTES AGRESIVOS</span>
                                <span className="text-purple-300 bg-purple-500/10 px-2 rounded-md">{sensitivity}s</span>
                                <span>PAUSAS NATURALES</span>
                            </div>
                        </div>

                        <input type="file" id="media" className="hidden" accept="video/*,audio/*" onChange={(e) => setFile(e.target.files[0])}/>
                        <label htmlFor="media" className="block py-12 border-2 border-dashed border-purple-500/20 rounded-[2rem] text-center mb-6 cursor-pointer hover:bg-purple-500/5 transition-all group">
                            <span className="text-5xl block mb-3 group-hover:scale-110 transition-transform">{file ? "‚úÖ" : "üìÅ"}</span>
                            <p className="text-xs font-bold text-gray-400 truncate px-4">{file ? file.name : "Subir Video o Audio"}</p>
                        </label>

                        {!outputUrl ? (
                            <button onClick={processMedia} disabled={!file || isProc} 
                                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 py-4 rounded-2xl font-black shadow-xl disabled:opacity-20 transition-all active:scale-95">
                                {isProc ? "‚ö° PROCESANDO..." : "GENERAR VIDEO SIN SILENCIO"}
                            </button>
                        ) : (
                            <div className="space-y-4">
                                <a href={outputUrl} download={`fastcut_${file.name}`} 
                                   className="w-full bg-green-500 py-4 rounded-2xl font-black text-center block shadow-lg animate-bounce">‚¨áÔ∏è DESCARGAR RESULTADO</a>
                                <button onClick={() => {setFile(null); setOutputUrl(null);}} className="w-full text-[10px] text-gray-500 uppercase font-black tracking-widest text-center">Procesar otro archivo</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
