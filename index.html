<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Truncar Silencio PRO | Audio & Video</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background: #0f172a; color: white; font-family: 'Inter', sans-serif; }
        .gradient-text { background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const { createFFmpeg, fetchFile } = FFmpeg;

        function App() {
            const [file, setFile] = useState(null);
            const [isProc, setIsProc] = useState(false);
            const [prog, setProg] = useState(0);
            const [outputUrl, setOutputUrl] = useState(null);
            const [sensitivity, setSensitivity] = useState(0.5);
            const ffmpeg = useRef(null);

            useEffect(() => { loadFFmpeg(); }, []);

            const loadFFmpeg = async () => {
                ffmpeg.current = createFFmpeg({ 
                    log: false,
                    corePath: 'https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js'
                });
                await ffmpeg.current.load();
            };

            const processMedia = async () => {
                if (!file) return;
                setIsProc(true); setProg(10);
                
                const inputName = 'input' + file.name.substring(file.name.lastIndexOf('.'));
                const outputName = file.type.includes('video') ? 'output.mp4' : 'output.mp3';

                ffmpeg.current.FS('writeFile', inputName, await fetchFile(file));

                // Filtro: silenceremove=stop_periods=-1:stop_duration=SENSITIVITY:stop_threshold=-30dB
                // Este comando corta tanto audio como video sincronizadamente
                await ffmpeg.current.run(
                    '-i', inputName,
                    '-af', `silenceremove=stop_periods=-1:stop_duration=${sensitivity}:stop_threshold=-30dB`,
                    '-vcodec', 'libx264', '-preset', 'ultrafast', '-crf', '28',
                    outputName
                );

                const data = ffmpeg.current.FS('readFile', outputName);
                setOutputUrl(URL.createObjectURL(new Blob([data.buffer], { type: file.type })));
                setProg(100); setIsProc(false);
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    <div className="bg-slate-900 border-2 border-purple-500/30 p-8 rounded-[2rem] max-w-md w-full shadow-2xl">
                        <h1 className="text-3xl font-black text-center gradient-text mb-4 uppercase">Truncar Pro AI</h1>
                        
                        <div className="mb-6 p-4 bg-black/30 rounded-xl border border-white/10">
                            <label className="text-xs font-bold text-purple-400 block mb-2 uppercase">Sensibilidad (Segundos de silencio)</label>
                            <input type="range" min="0.1" max="1.5" step="0.1" value={sensitivity} 
                                   onChange={(e) => setSensitivity(e.target.value)} className="w-full accent-purple-500"/>
                            <div className="flex justify-between text-[10px] mt-1 text-gray-400">
                                <span>Cortes rÃ¡pidos (0.1s)</span>
                                <span className="text-white font-bold">{sensitivity}s</span>
                                <span>Natural (1.5s)</span>
                            </div>
                        </div>

                        <input type="file" id="media" className="hidden" accept="video/*,audio/*" onChange={(e) => setFile(e.target.files[0])}/>
                        <label htmlFor="media" className="block p-10 border-2 border-dashed border-purple-500/20 rounded-2xl text-center mb-6 cursor-pointer hover:bg-purple-500/5 transition">
                            <span className="text-4xl block mb-2">{file ? "âœ…" : "ðŸŽ¬"}</span>
                            <span className="text-sm font-bold text-gray-300">{file ? file.name : "Subir Audio o Video"}</span>
                        </label>

                        {!outputUrl ? (
                            <button onClick={processMedia} disabled={!file || isProc} 
                                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 py-4 rounded-xl font-black shadow-lg disabled:opacity-30">
                                {isProc ? "PROCESANDO..." : "ELIMINAR SILENCIOS"}
                            </button>
                        ) : (
                            <div className="space-y-4">
                                <a href={outputUrl} download={`truncado_${file.name}`} 
                                   className="w-full bg-green-600 py-4 rounded-xl font-black text-center block shadow-lg">DESCARGAR RESULTADO</a>
                                <button onClick={() => {setFile(null); setOutputUrl(null); setProg(0);}} className="w-full text-xs text-gray-500 uppercase font-bold">Reiniciar</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
